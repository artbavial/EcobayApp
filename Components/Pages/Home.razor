@page "/"
@page "/{slug:nonfile?}"
@rendermode InteractiveServer
@inject AppDBContext Db
@inject IEmailSender EmailSender
@inject IJSRuntime JS
@using EcobayApp.Contex
@using EcobayApp.Models
@using System.Net
@using System.Net.Mail
@using Microsoft.EntityFrameworkCore
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components.Web


<PageTitle>@Title</PageTitle>
<HeadContent>
    <meta name="description" content="@(pageCity?.Description ?? "Вывоз и утилизация бытовой техники в Гомеле, Бобруйске, Жлобине, Рогачеве")" />
    <meta name="keywords" content="@(pageCity?.KeyWords ?? "утилизация, техника, переработка, приём техники, утилизация электроники")" />
</HeadContent>

<!-- preloader -->
@* <div class="loader"><span>Loading</span></div> *@

<div id="scroll-content">
    <!-- hero -->
    <header id="top" class="d-flex flex-column">
        <!-- Desktop Menu -->
        <nav class="starta-nav">
            <div class="container d-flex justify-content-between align-items-center">
                <div class="logo">
                    <img src="images/hero/icon.png" alt="Icon" />Ecobay<span>.by</span>
                </div>
                <ul class="list-unstyled starta-menu">
                    <li><a class="menu-animation active" href="#top">Начало</a></li>
                    <li><a class="menu-animation" href="#about">О нас</a></li>
                    <li><a class="menu-animation" href="#services">Что принимаем</a></li>
                    <li><a class="menu-animation" href="#plan">Цены</a></li>
                    <li><a class="menu-animation" href="#team">Наша работа</a></li>
                    <li><a class="menu-animation" href="#faqs">Частые вопросы</a></li>
                </ul>
                <a href="tel:@phone" class="starta-helpline">
                    <i class="fa-solid fa-phone-volume"></i>
                    <article>
                        <h4>Связаться с нами</h4>
                        <p>@phone</p>
                    </article>
                </a>
            </div>
        </nav>

        <!-- Mobile Menu Icon -->
        <li class="menuIcon" id="menuBtn">
            <span></span>
            <span></span>
            <span></span>
        </li>

        <!-- Mobile Menu -->
        <nav class="starta-mobile-nav">
            <ul class="list-unstyled starta-menu">
                <li><a class="menu-animation active" href="#top">Начало</a></li>
                <li><a class="menu-animation" href="#about">О нас</a></li>
                <li><a class="menu-animation" href="#services">Что принимаем</a></li>
                <li><a class="menu-animation" href="#plan">Цены</a></li>
                <li><a class="menu-animation" href="#team">Наша работа</a></li>
                <li><a class="menu-animation" href="#faqs">Частые вопросы</a></li>
            </ul>
        </nav>

        @if (isPromoVisible)
        {
            <div class="promo-overlay" @onclick="ClosePromo">
                <div class="promo-modal"
                     @onclick:stopPropagation="true">
                    <h2 class="starta-h2 mb-3">@promoTitle</h2>
                    <p class="starta-desc mb-3">@promoText</p>

                    <button class="starta-button w-100" @onclick="ClosePromo">
                        <span class="position-relative">Понятно</span>
                        <span class="starta-button-hover"></span>
                    </button>
                </div>
            </div>
        }


        <div class="container d-flex flex-column flex-grow-1 position-relative z-index-3">
            <!-- hero section -->
            <section class="starta-hero my-5 d-flex flex-column justify-content-center flex-grow-1">
                <div class="row mt-5 pt-4">
                    <!-- ТЕКСТОВАЯ КОЛОНКА ВВЕРХУ (на мобиле и десктопе) -->
                    <div class="col-12 col-md-7">
                        <h1 class="heroHeading">
                            @if (currentCity is not null)
                            {
                                @($"Быстрый вывоз техники на утилизацию в {currentCity.NameIn}")
                            }
                            else
                            {
                                @("Быстрый вывоз техники на утилизацию")
                            }
                        </h1>


                        <!-- КОРОТКИЙ ТЕКСТ С ЦЕНОЙ (Только мобиле) -->
                        <p class="heroDesc d-block d-md-none">
                            Быстро заберём технику на утилизацию и заплатим за каждый килограмм.
                            Оставьте заявку — перезвоним и согласуем удобное время выезда.
                            <span style="font-size:22px;"><strong> от @price копеек за килограмм</strong></span>
                        </p>

                        <!-- ДЛИННЫЙ ТЕКСТ (Только на десктопе) -->
                        <p class="heroDesc d-none d-md-block">
                            С нами всё просто: оставляете заявку или звоните — мы сами приезжаем по вашему адресу.
                            Наши специалисты аккуратно вынесут и погрузят технику, а расчёт произведём прямо на месте.
                            За каждый килограмм техники платим <strong>мы</strong>, а итоговая сумма зависит от её веса.
                            Вы получаете честную оплату и удобный сервис без лишних хлопот — от
                            <span style="font-size:22px;"><strong>@price копеек за кг.</strong></span>
                            Вся техника отправляется на переработку — ваше решение помогает экологии нашей планеты.
                        </p>

                        <!-- Иконки (ТОЛЬКО на десктопе) -->
                        <div class="col-md-8 mt-5 d-none d-md-block">
                            <div class="row">
                                <div class="col-md-3 col-3">
                                    <img src="images/hero/services/1.png" alt="Утилизация" class="hero-service w-100" />
                                </div>
                                <div class="col-md-3 col-3">
                                    <img src="images/hero/services/2.png" alt="Утилизация" class="hero-service w-100" />
                                </div>
                                <div class="col-md-3 col-3">
                                    <img src="images/hero/services/3.png" alt="Утилизация" class="hero-service w-100" />
                                </div>
                                <div class="col-md-3 col-3">
                                    <img src="images/hero/services/4.png" alt="Утилизация" class="hero-service w-100" />
                                </div>
                            </div>
                        </div>

                        <!-- Кнопка "Позвонить" -->
                        <a href="tel:@phone" class="starta-button call-button mt-5">
                            <span class="position-relative">@phone</span>
                            <span class="starta-button-hover"></span>
                        </a>
                    </div>

                    <!-- ФОРМА (Вторая колонка на десктопе, внизу на мобиле) -->
                    <div class="col-12 col-md-5 position-relative mt-5 mt-md-0">
                        <!-- Shapes (ТОЛЬКО на десктопе) -->
                        <div class="shapes d-none d-md-block">
                            <img src="images/hero/shape1.svg" alt="shape" />
                            <img src="images/hero/shape2.svg" alt="shape" />
                            <img src="images/hero/shape3.svg" alt="shape" />
                        </div>

                        <EditForm Model="form" OnValidSubmit="OnSubmitAsync">>

                            <div class="heroForm">
                                <article class="formContent">
                                    <h2 class="starta-h2">Оставьте заявку</h2>
                                    <p class="starta-desc">
                                        Мы свяжемся с вами в ближайшее время
                                    </p>
                                </article>

                                <div class="inputField">
                                    <InputText class="starta-desc"
                                               @bind-Value="form.Name"
                                               placeholder="Ваше имя" />
                                    <i class="fa-solid fa-user"></i>
                                </div>

                                <div class="inputField">
                                    <InputText class="starta-desc"
                                                @bind-Value="form.Phone"
                                                placeholder="Ваш телефон"
                                               @onfocus="EventCallback.Factory.Create(this, OnPhoneFocus)" />
                                </div>

                                <div class="inputField messageField">
                                    <InputTextArea class="starta-desc"
                                                   @bind-Value="form.Comment"
                                                   rows="3"
                                                   placeholder="Ваше сообщение" />
                                    <i class="fa-solid fa-comment"></i>
                                </div>

                                <div class="border-bottom pt-4 mb-4"></div>

                                <button class="starta-button w-100"
                                        type="submit"
                                        disabled="@isSending">
                                    <span class="position-relative">
                                        @(isSending ? "Отправка..." : "Отправить заявку")
                                    </span>
                                    <span class="starta-button-hover"></span>
                                </button>

                                @if (!string.IsNullOrEmpty(formErrorMessage))
                                {
                                    <p class="starta-desc mt-3" style="color:#dc3545;">
                                        @formErrorMessage
                                    </p>
                                }
                                else if (isSuccessMessageVisible)
                                {
                                    <p class="starta-desc mt-3" style="color:#28a745;">
                                        Заявка успешно отправлена. Мы свяжемся с вами в ближайшее время.
                                    </p>
                                }
                            </div>
                        </EditForm>
                    </div>
                </div>
            </section>
        </div>

        <!-- Hero Background -->
        <div class="heroBG">
            <img src="images/hero/bg.jpg" alt="Background" />
        </div>
    </header>


    <!-- Starta about -->
    <!-- Features -->
    <section class="startaFeatures" id="about">
        <div class="container">
            <div class="row my-5 pb-4 justify-content-between align-items-center">
                <!-- Feature single -->
                <div class="col-md-4 col-sm-6">
                    <div class="row align-items-center featureSingle">
                        <div class="col-md-4">
                            <i class="starta-icon featureIcon fa-regular fa-lightbulb"></i>
                        </div>
                        <div class="col-md-7">
                            <article>
                                <h4 class="starta-h4">Экологично</h4>
                                <p class="starta-desc">
                                    Вся техника гарантированно будет переработана
                                </p>
                            </article>
                        </div>
                    </div>
                </div>
                <!-- feature single -->
                <div class="col-md-4 col-sm-6">
                    <div class="row align-items-center featureSingle">
                        <div class="col-md-4">
                            <i class="starta-icon featureIcon fa-regular fa-lightbulb"></i>
                        </div>
                        <div class="col-md-7">
                            <article>
                                <h4 class="starta-h4">Удобно</h4>
                                <p class="starta-desc">
                                    Вынесем и погрузим самостоятельно.
                                </p>
                            </article>
                        </div>
                    </div>
                </div>
                <!-- feature single -->
                <div class="col-md-4 col-sm-6">
                    <div class="row align-items-center featureSingle">
                        <div class="col-md-4">
                            <i class="starta-icon featureIcon fa-regular fa-lightbulb"></i>
                        </div>
                        <div class="col-md-7">
                            <article>
                                <h4 class="starta-h4">Выгодно</h4>
                                <p class="starta-desc">
                                    Вы получите деньги сразу на месте.
                                </p>
                            </article>
                        </div>
                    </div>
                </div>
            </div>

            <!-- gap -->
            <div class="lineGap my-4"></div>
            <div class="row my-5 py-md-4">
                <!-- Starta BLock -->
                <div class="col-md-6 position-relative">
                    <img class="starta-block-img animate-img"
                         src="images/main/block1.png"
                         alt="Block" />

                    <div class="starta-performance">
                        <h4 class="starta-h4 fw-normal mb-3">Наши цели @thisYear</h4>
                        <div class="row pb-3 border-bottom">
                            <div class="col-md-6 col-sm-6 col-6">
                                <div class="row">
                                    <div class="col-md-4 pe-0">
                                        <i class="performance-icon fa-solid fa-display"></i>
                                    </div>
                                    <div class="col-md-8 ps-1">
                                        <article>
                                            <h4 class="starta-h4 d-flex align-items-center fw-normal mb-0">
                                                @totalClientsDisplay<i class="fa-solid fa-arrow-up"></i>
                                            </h4>
                                            <p class="starta-descbox">Клиентов</p>
                                        </article>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6 col-6">
                                <div class="row">
                                    <div class="col-md-4 pe-0">
                                        <i class="performance-icon fa-solid fa-signal"></i>
                                    </div>
                                    <div class="col-md-8 ps-1">
                                        <article>
                                            <h4 class="starta-h4 d-flex align-items-center fw-normal mb-0">
                                                @totalItemsDisplay<i class="fa-solid fa-arrow-up"></i>
                                            </h4>
                                            <p class="starta-descbox">Ед. техники</p>
                                        </article>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h5 class="starta-h5 my-3">
                            Выполнение цели <span>@ProgresPercent%</span>
                        </h5>
                        <div class="bar">
                            <div class="fill" style="width:@ProgresPercent%;"></div>
                        </div>
                    </div>


                </div>

                <!-- About Content -->
                <div class="col-md-6 mt-3">
                    <h2 class="starta-heading">
                        <i class="fa-solid fa-star"></i>Наши достижения.
                    </h2>
                    <h1 class="starta-h1">Мы занимаемся вывозом бытовой техники с 2018 года</h1>
                    <p class="starta-desc">
                        За это время мы вывезли на утилизацию и переработу тысячи тонн техники, среди которых тысячи холодильников, телевизоров, стиральных машин, газовых плинт. Десятки тысяч мелкой бытовой техники.
                        <a href="">Наша работа очень важна для экологии и будущего.</a>
                        В ежедневном режиме наша служба продолжает помогать многим людям избавляя от хлама квартиры, дома и дачи. Ждем твоей заявки.
                    </p>
                    <div class="row my-3">

                        <div class="col-md-7">
                            <ul class="starta-list list-unstyled">
                                <li>
                                    <i class="fa-solid fa-circle-check"></i>Много клиентов обращаются повторно!
                                </li>
                                <li>
                                    <i class="fa-solid fa-circle-check"></i>Каждая ваша заявка важна !
                                </li>
                                <li>
                                    <i class="fa-solid fa-circle-check"></i>Честный расчет!
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

   

    <!-- Starta Project -->
    <section id="services" class="starta-service">
        <div class="container">
            <div class="row mt-3">
                <div class="col-md-6 pe-md-5">
                    <!-- Video BLock -->
                    <div class="video-block mb-4">
                        <img class="starta-block-img"
                             src="images/main/project/videoBG.jpg"
                             alt="BG" />

                        <!-- PLay Button -->
                        <div class="playBtn startplay">
                            <i class="fa-solid fa-play"></i>
                            <span id="circle-text">
                                &nbsp;. смотреть видео . смотреть видео . смотреть видео 
                            </span>
                        </div>

                        <!-- video frame -->
                        <iframe src="https://www.youtube.com/embed/e0TblOS6o_s;controls=0"
                                title="Sample Video"
                                frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                referrerpolicy="strict-origin-when-cross-origin"
                                allowfullscreen></iframe>
                        <i class="close fa-solid fa-circle-xmark"></i>
                    </div>


                    <!-- Списки -->
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="starta-list list-unstyled">
                                <li class="mb-3">
                                    <i class="fa-solid fa-circle-check"></i> Принимаем в том числе и неисправную технику.
                                </li>
                                <li class="mb-3">
                                    <i class="fa-solid fa-circle-check"></i> Любые габариты бытовой техники.
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="starta-list list-unstyled">
                                <li class="mb-3">
                                    <i class="fa-solid fa-circle-check"></i> Принимаем всё, что осталось от бытовой техники и приборов.
                                </li>
                                <li class="mb-3">
                                    <i class="fa-solid fa-circle-check"></i> И вообще принимаем всё, что не запрещено законом :)
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Правая колонка -->
                <div class="col-md-6">
                    <h2 class="starta-heading">Что мы принимаем</h2>
                    <h1 class="starta-h1">
                        Мы принимаем любую бытовую технику!
                    </h1>
                    <p class="starta-desc">
                        В любом состоянии: холодильники, стиральные машины,
                        телевизоры, газовые плиты, компьютеры и электроника,
                        мелкая бытовая техника и многое другое.
                        Будьте уверены — любую технику заберём.
                    </p>
                    <img class="starta-block-img mt-3"
                         src="images/main/project/blockImg2.png"
                         alt="Block Img" />
                </div>
            </div>
        </div>
    </section>


    <!-- Starta Service -->
    @* <section id="services" class="starta-service">
        <div class="container">
            <h1 class="starta-heading mx-auto">Ecobay.by сервис вывоза</h1>
            <h1 class="starta-h1 text-center mb-md-5">
                Какую технику принимаем
            </h1>
            <div class="row">
                <div class="col-md-4 col-sm-6">
                    <div class="service">
                        <div class="serviceImg">
                            <div class="imgOverlay">
                                <i class="servicePlay fa-solid fa-link"><span>Copy?</span></i>
                                <a href="https://www.youtube.com/watch?v=O5O3yK8DJCc&t=12s"
                                   target="_blank">
                                    <i class="ytLink fa-solid fa-play"></i>
                                </a>
                            </div>
                            <img src="images/main/services/1.jpg" alt="Service" />
                        </div>
                        <article class="serviceContent">
                            <span>Easy Chating UI</span>
                            <h4 class="starta-h4">Video Meeting</h4>
                        </article>
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="service">
                        <div class="serviceImg">
                            <div class="imgOverlay">
                                <i class="servicePlay fa-solid fa-link"><span>Copy?</span></i>
                                <a href="https://www.youtube.com/watch?v=O5O3yK8DJCc&t=12s"
                                   target="_blank">
                                    <i class="ytLink fa-solid fa-play"></i>
                                </a>
                            </div>
                            <img src="images/main/services/2.jpg" alt="Service" />
                        </div>
                        <article class="serviceContent">
                            <span>Easy Chating UI</span>
                            <h4 class="starta-h4">Video Meeting</h4>
                        </article>
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="service">
                        <div class="serviceImg">
                            <div class="imgOverlay">
                                <i class="servicePlay fa-solid fa-link"><span>Copy?</span></i>
                                <a href="https://www.youtube.com/watch?v=O5O3yK8DJCc&t=12s"
                                   target="_blank">
                                    <i class="ytLink fa-solid fa-play"></i>
                                </a>
                            </div>
                            <img src="images/main/services/3.jpg" alt="Service" />
                        </div>
                        <article class="serviceContent">
                            <span>Easy Chating UI</span>
                            <h4 class="starta-h4">Video Meeting</h4>
                        </article>
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="service">
                        <div class="serviceImg">
                            <div class="imgOverlay">
                                <i class="servicePlay fa-solid fa-link"><span>Copy?</span></i>
                                <a href="https://www.youtube.com/watch?v=O5O3yK8DJCc&t=12s"
                                   target="_blank">
                                    <i class="ytLink fa-solid fa-play"></i>
                                </a>
                            </div>
                            <img src="images/main/services/4.jpg" alt="Service" />
                        </div>
                        <article class="serviceContent">
                            <span>Easy Chating UI</span>
                            <h4 class="starta-h4">Video Meeting</h4>
                        </article>
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="service">
                        <div class="serviceImg">
                            <div class="imgOverlay">
                                <i class="servicePlay fa-solid fa-link"><span>Copy?</span></i>
                                <a href="https://www.youtube.com/watch?v=O5O3yK8DJCc&t=12s"
                                   target="_blank">
                                    <i class="ytLink fa-solid fa-play"></i>
                                </a>
                            </div>
                            <img src="images/main/services/5.jpg" alt="Service" />
                        </div>
                        <article class="serviceContent">
                            <span>Easy Chating UI</span>
                            <h4 class="starta-h4">Video Meeting</h4>
                        </article>
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="service">
                        <div class="serviceImg">
                            <div class="imgOverlay">
                                <i class="servicePlay fa-solid fa-link"><span>Copy?</span></i>
                                <a href="https://www.youtube.com/watch?v=O5O3yK8DJCc&t=12s"
                                   target="_blank">
                                    <i class="ytLink fa-solid fa-play"></i>
                                </a>
                            </div>
                            <img src="images/main/services/6.jpg" alt="Service" />
                        </div>
                        <article class="serviceContent">
                            <span>Easy Chating UI</span>
                            <h4 class="starta-h4">Video Meeting</h4>
                        </article>
                    </div>
                </div>
            </div>
        </div>
    </section> *@

    <section class="starta-plans" id="plan">
        <div class="container">
            <h1 class="starta-heading mx-auto">Цены за бытовую технику</h1>
            <h1 class="starta-h1 text-center">
                Самое интересное, сколько денег можно получить! :)
            </h1>

            <div class="row justify-content-center">
                <!-- Калькулятор -->
                <div class="col-md-4 lap-sm-50 tab-100">
                    <div class="plan best">
                        <div class="row align-items-center">
                            <div class="col-md-5 col-sm-3 col-5">
                                <i class="starta-icon featureIcon fa-solid fa-scale-balanced"></i>
                            </div>
                            <div class="col-md-7 p-md-0 col-sm-9 col-7">
                                <article class="plan-heading">
                                    <h3 class="starta-h2">Калькулятор цены</h3>
                                    <p class="starta-h2"><span>@price</span> BYN/кг</p>
                                </article>
                            </div>

                            <div class="my-4">
                                <input type="number"
                                       class="form-control"
                                       placeholder="Введите вес (кг)"
                                       @bind="weight"
                                       min="0"
                                       step="0.1"
                                       @oninput="Calculate" />
                            </div>

                            <button class="starta-button" type="button" @onclick="Calculate">
                                <span class="position-relative">Рассчитать</span>
                                <span class="starta-button-hover"></span>
                            </button>

                            <p class="starta-desc fw-medium mt-3" style="min-height: 40px;">
                                @((MarkupString)resultMessage)
                            </p>
                        </div>

                        <span class="discount">* Конечную цену уточняйте у менеджера</span>
                    </div>
                </div>

                <!-- Справочный вес -->
                <div class="col-md-4 lap-sm-50 tab-100">
                    <div class="plan info">
                        <h3 class="starta-h2 text-center">Вес техники*</h3>
                        <strong>Вес указан в килогаммах</strong>
                        <ul class="starta-desc">
                            <li>Холодильник <strong>~ 45–80</strong></li>
                            <li>Стиральная машина <strong>~ 50–80</strong></li>
                            <li>Советская стиралка <strong>~ 10–45</strong></li>
                            <li>Телевизор <strong>~ 10–50</strong></li>
                            <li>Газовая плита <strong>~ 28–56</strong></li>
                            <li>Газовый котёл <strong>~ 40–150</strong></li>
                            <li>Газовая колонка <strong>~ 15–40</strong></li>
                        </ul>
                        <span class="discount">
                            * Указанные значения носят справочный характер.
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="starta-details py-5 my-5" id="team">
        <div class="container">
            <div class="row">
                <!-- Текстовый блок -->
                <div class="col-md-6">
                    <h1 class="starta-heading">Наши будние дни</h1>
                    <h1 class="starta-h1">Мы вывозим технику ежедневно. Выходной — воскресенье.</h1>
                    <p class="starta-desc">
                        Начиная с 9 утра и до позднего вечера, наша служба принимает заявки и вывозит технику по согласованному времени.
                    </p>
                    <ul class="list-unstyled details-list">
                        <li>
                            <img src="images/main/services/details/1.png"
                                 alt="Icon" />
                            Обработка заявки и согласование удобного времени.
                        </li>
                        <li>
                            <img src="images/main/services/details/2.png"
                                 alt="Icon" />
                            В договорённое время мы перезваниваем и уточняем детали.
                        </li>
                        <li>
                            <img src="images/main/services/details/3.png"
                                 alt="Icon" />
                            Приезжаем к вам по адресу и вывозим технику.
                        </li>
                    </ul>
                </div>

                <!-- Блок с картинками -->
                <div class="col-12 col-md-6 position-relative mt-4 mt-md-0">
                    <div class="details_img detail_img1">
                        <img src="images/main/services/details/detail1.jpg"
                             alt="Details" />
                    </div>
                    <div class="details_img detail_img2">
                        <img src="images/main/services/details/detail3.jpg"
                             alt="Details" />
                    </div>
                    <div class="details_img detail_img3">
                        <img src="images/main/services/details/detail2.jpg"
                             alt="Details" />
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- About 2 -->
    <section class="starta-about pb-5 my-5">
        <div class="container position-relative" style="z-index: 2">
            <div class="about-inner pt-4 position-relative">
                <!-- video Block -->
                <div class="video-block animate-block">
                    <img class="starta-block-img"
                         src="images/main/about/videoBG2.jpg"
                         alt="BG" />
                    <!-- play button -->
                    <div class="play-btn">
                        <i class="startplay fa-solid fa-circle-play">
                            <span class="glow"></span>
                        </i>
                    </div>
                    <h1 class="starta-h1 starta-h1-2 text-center mx-auto">
                        Утилизация техники в Беларуси
                    </h1>


                    <iframe src="https://www.youtube.com/embed/heUa5ZOVo3o?controls=0"
                            title="Sample Video"
                            frameborder="0"
                            width="560"
                            height="315"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            referrerpolicy="strict-origin-when-cross-origin"
                            allowfullscreen
                            style="border-radius:15px;">
                    </iframe>

                    <i class="close fa-solid fa-circle-xmark"></i>
                </div>
                <div class="row align-items-center pt-5">
                    <div class="col-md-7 pt-3">
                        <h5 class="starta-semi">Юридическая информация</h5>
                        <h1 class="starta-h1">
                            100% официально в соответствии с законодательством РБ.
                        </h1>

                        <!-- clients  -->
                        <div class="clients">
                            <div class="row">
@*                                 <div class="col-md-3 col-sm-3 col-3">
                                    <div class="client">
                                        <img src="images/main/about/clients/c1.png"
                                             alt="Client" />
                                    </div>
                                </div> *@
@*                                 <div class="col-md-3 col-sm-3 col-3">
                                    <div class="client">
                                        <img src="images/main/about/clients/c2.png"
                                             alt="Client" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-3 col-3">
                                    <div class="client">
                                        <img src="images/main/about/clients/c3.png"
                                             alt="Client" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-3 col-3">
                                    <div class="client">
                                        <img src="images/main/about/clients/c4.png"
                                             alt="Client" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-3 col-3">
                                    <div class="client">
                                        <img src="images/main/about/clients/c5.png"
                                             alt="Client" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-3 col-3">
                                    <div class="client">
                                        <img src="images/main/about/clients/c6.png"
                                             alt="Client" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-3 col-3">
                                    <div class="client">
                                        <img src="images/main/about/clients/c7.png"
                                             alt="Client" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-3 col-3">
                                    <div class="client">
                                        <img src="images/main/about/clients/c1.png"
                                             alt="Client" />
                                    </div>
                                </div> *@
                                <button class="starta-button w-auto mx-auto starta-button-2"
                                        type="button"
                                        onclick="window.open('/user-agreement', '_blank');">
                                    <span class="position-relative">Пользовательское соглашение</span>
                                </button>

                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <p class="starta-desc mt-sm-4">
                            Принимаемая бытовая техника, отправляется на переработку
                            и утилизацию согласно всех требований и норм
                            законодательства Республики Беларусь.
                        </p>
                        <div class="row align-items-center">
                            <div class="col-md-3 col-sm-2 col-3">
                                <img class="check"
                                     src="images/main/about/check.png"
                                     alt="Check" />
                            </div>
                            <div class="col-md-9 my-5 col-sm-10 col-9">
                                <h5 class="starta-h3">Все разрешительные документы на прием бытовой техники.</h5>
                                <p class="starta-semi"></p>
                            </div>
                            <ul class="starta-list list-unstyled">
                                <li>
                                    <i class="fa-solid fa-circle-check"></i>Информация отправленная пользователями конфиденциальна и не передается третьим лицам.
                                </li>
                                <li>
                                    <i class="fa-solid fa-circle-check"></i>Сайт, логотип тексты защищены авторскими правами.
                                </li>
                                <li>
                                    <i class="fa-solid fa-circle-check"></i>Копирование без разрешения запрещено.
                                </li>
                            </ul>
                        </div>

                        <!-- Contact Box -->
                        <div class="contact-box mt-5">
                            <div class="row align-items-center">
                                <div class="col-md-2 col-sm-2 col-2">
                                    <i class="fa-solid fa-envelope-open"></i>
                                </div>
                                <div class="col-md-10 col-sm-10 col-10">
                                    <article>
                                        Остались вопросы? Напишите нам
                                        <a href="#">info@ecobay.by</a>
                                    </article>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- starta about bg -->
        <div class="starta-about-bg">
            <img src="images/main/about/aboutBG.png" alt="" />
        </div>
    </section>

    <!-- Starta Faqs -->
    <section class="starta-faq my-5 pb-md-5" id="faqs">
        <div class="container pt-4">
            <h1 class="starta-heading mx-auto">Частые вопросы</h1>
            <h1 class="starta-h1 text-center">Все ответы на ваши вопросы.</h1>

            <div class="accordion accordion-flush" id="startaFaq">
                <!-- FAQ 1 -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#faq1"
                                aria-expanded="true"
                                aria-controls="faq1">
                            Как долго нужно ждать вывоза техники?
                        </button>
                    </h2>

                    <div id="faq1" data-bs-parent="#startaFaq" class="collapse show">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-12">
                                    <h3 class="starta-h3">
                                        Обычно вывозим в день заявки или на следующий день.
                                    </h3>
                                    <p class="starta-desc">
                                        В большинстве случаев выезд происходит в день обращения или уже на следующий день.
                                        В редких ситуациях ожидание может составить несколько дней — всё зависит от загрузки
                                        и вашего района.
                                    </p>
                                    <p class="starta-desc">
                                        Если вам нужен срочный вывоз, обязательно скажите об этом оператору или укажите в
                                        комментарии к заявке — такие обращения стараемся ставить в приоритет и подстраиваемся
                                        под удобное для вас время.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FAQ 2 -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="collapsed"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#faq2"
                                aria-expanded="false"
                                aria-controls="faq2">
                            У меня бытовая техника неисправна, это влияет на цену?
                        </button>
                    </h2>

                    <div id="faq2" data-bs-parent="#startaFaq" class="collapse">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-12">
                                    <h3 class="starta-h3">
                                        Нет, исправность техники на цену не влияет.
                                    </h3>
                                    <p class="starta-desc">
                                        Мы принимаем технику на переработку и утилизацию, поэтому для нас неважно, работает
                                        она или давно вышла из строя. Главное — чтобы её можно было безопасно вывезти.
                                    </p>
                                    <p class="starta-desc">
                                        Смело оставляйте заявку даже если техника сломана, разобрана или частично не
                                        комплектна — условия оплаты остаются такими же, как для исправных приборов.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="collapsed"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#faq3"
                                aria-expanded="false"
                                aria-controls="faq3">
                            Можно ли сдать фен, утюг или мобильный телефон?
                        </button>
                    </h2>

                    <div id="faq3" data-bs-parent="#startaFaq" class="collapse">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-12">
                                    <h3 class="starta-h3">
                                        Да, но выезд от 10 кг техники.
                                    </h3>
                                    <p class="starta-desc">
                                        Отдельно за одним феном, утюгом или телефоном мы не выезжаем.
                                        Выезд осуществляется, когда общий вес техники от 10 кг и выше —
                                        например, если есть хотя бы микроволновка или несколько приборов вместе.
                                    </p>
                                    <p class="starta-desc">
                                        Мелкую технику можно собрать и сдать вместе с крупной — так мы заберём всё за один выезд.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FAQ 4: Бывают ли выходные -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="collapsed"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#faq4"
                                aria-expanded="false"
                                aria-controls="faq4">
                            Бывают ли у вас выходные?
                        </button>
                    </h2>

                    <div id="faq4" data-bs-parent="#startaFaq" class="collapse">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-12">
                                    <h3 class="starta-h3">
                                        Да, но заявки принимаем каждый день.
                                    </h3>
                                    <p class="starta-desc">
                                        Выезды обычно не выполняются по воскресеньям и в праздничные дни.
                                        В эти дни техника не вывозится, но вы можете спокойно оставить заявку заранее.
                                    </p>
                                    <p class="starta-desc">
                                        Заявки принимаются ежедневно — по телефону и через сайт.
                                        Мы свяжемся с вами в ближайшее время (даже если это выходной) и согласуем удобное время вывоза.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>


    <!-- Starta Testionials -->
    <section class="starta-testimonials py-5">
        <div class="container py-5">
            <div class="testimonialsSlides">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <!-- Testionial Single -->
                        <div class="testimonialSingle py-5">
                            <div class="row position-relative justify-content-center">
                                <div class="col-md-3 text-end col-sm-3 col-3">
                                    <img class="qoute"
                                         src="images/main/members/quote.png"
                                         alt="Quote" />
                                    <div class="d-inline-block">
                                        <img class="testimonialClient"
                                             src="images/main/members/member3.png"
                                             alt="Client" />
                                        <div class="stars clientStars">
                                            <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-7 col-sm-9 col-9">
                                    <h2 class="starta-h2">
                                        Спасибо большое, вывезли у родителей со двора этот старый хлам, а то они складировали его годами, а оно все уже давно хламьё.
                                        Буду рекомендовать!
                                    </h2>
                                    <h4 class="starta-h4">Владимир (Жлобин)</h4>
                                </div>
                            </div>
                            <div class="testimonialCircle"></div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <!-- Testionial Single -->
                        <div class="testimonialSingle py-5">
                            <div class="row position-relative justify-content-center">
                                <div class="col-md-3 text-end col-sm-3 col-3">
                                    <img class="qoute"
                                         src="images/main/members/quote.png"
                                         alt="Quote" />
                                    <div class="d-inline-block">
                                        <img class="testimonialClient"
                                             src="images/main/members/member4.png"
                                             alt="Client" />
                                        <div class="stars clientStars">
                                            <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-7 col-sm-9 col-9">
                                    <h2 class="starta-h2">
                                        Спасибо мальчикам! Отключили и вынесли старую стиральную машину.
                                        Передайте им большое спасибо, я уже думала нанять кого,
                                        что бы вынесли на мусор ее.
                                    </h2>
                                    <h4 class="stara-h4">Надежда (Гомель)</h4>
                                </div>
                            </div>
                            <div class="testimonialCircle"></div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <!-- Testionial Single -->
                        <div class="testimonialSingle py-5">
                            <div class="row position-relative justify-content-center">
                                <div class="col-md-3 text-end col-sm-3 col-3">
                                    <img class="qoute"
                                         src="images/main/members/quote.png"
                                         alt="Quote" />
                                    <div class="d-inline-block">
                                        <img class="testimonialClient"
                                             src="images/main/members/member2.png"
                                             alt="Client" />
                                        <div class="stars clientStars">
                                            <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-7 col-sm-9 col-9">
                                    <h2 class="starta-h2">
                                        Купили старый дом, думали что придется грузовик нанимать что бы всю эту старую технику вывезти.
                                        А тут оказывается еще и денюшку получили. Осталось найти куда так-же избавится от старой мебели.
                                    </h2>
                                    <h4 class="stara-h4">Дарья (Бобруйск)</h4>
                                </div>
                            </div>
                            <div class="testimonialCircle"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    @* <section class="starta-stories py-md-5 my-5">
        <div class="container">
            <a class="starta-h3 d-block text-center mb-4" href="#">Фотографии</a>

            <!-- Insta Feed -->
            <div class="instaFeed swiper">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed1.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed2.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed3.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed4.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed5.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed6.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed7.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed1.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed2.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed3.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed4.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed5.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed6.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                    <div class="swiper-slide">
                        <div class="swiper-material-wrapper">
                            <div class="swiper-material-content">
                                <img src="images/main/feed/feed7.jpg" alt="feed" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section> *@

    <!-- starta footer -->
    <footer class="starta-footer pt-5">
        <div class="container py-5">
            <div class="row">
                <!-- block 1 -->
                <div class="col-md-5 border-end">
                    <h1 class="starta-h1">Ecobay.by</h1>
                    <p class="starta-desc">
                        Прием бытовой техники в Гомеле, Бобруйске,
                        Рогачеве, Жлобине и  в других городах, районах.
                    </p>
                    <ul class="starta-social list-unstyled">
                        <li>
                            <a href="https://www.tiktok.com/@@ecobay.by?_r=1"><i class="fa-brands fa-tiktok"></i></a>
                        </li>
                        <li>
                            <a href="https://www.instagram.com/ecobay.by?igsh=anR4enZ4cWRtZXlv"><i class="fa-brands fa-instagram"></i></a>
                        </li>
                        <li>
                            <a href="https://vk.ru/ecobayby"><i class="fa-brands fa-vk"></i></a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-4 lap-sm-50 tab-100 mt-sm-4">
                    <div class="row mx-auto">
                        <!-- block 2 -->
                        <div class="col-md-6 col-sm-6">
                            <h4 class="starta-h4 mb-4">Где мы работаем</h4>
                            <ul class="footer-list list-unstyled">
                                @foreach (var pc in footerCities)
                                {
                                    var cityNameIn = pc.City?.NameIn ?? pc.City?.Name ?? "городе";
                                    var slug = pc.City?.Slug ?? "gomel";

                                    <li>
                                        <a class="menu-animation" href=@($"/{slug}")>
                                            Сдать бытовую технику в @cityNameIn
                                        </a>
                                    </li>
                                }
                            </ul>
                        </div>
                        <!-- block 3 -->
                        <div class="col-md-6 col-sm-6">
                            <h4 class="starta-h4 mb-4">Дополнительная информация</h4>
                            <ul class="footer-list list-unstyled">
                                <li>
                                    <a class="menu-animation" href="#">Правила сайта и защита персональных данных</a>
                                </li>
                                <li>
                                    <a class="menu-animation" href="#">Контакты</a>
                                </li>
                                <li>
                                    <a class="menu-animation" href="#">Жалобы и предложения</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

@*                 <!-- block 4 -->
                <div class="col-md-3 lap-sm-100">
                    <h4 class="starta-h4 mb-4 lap-sm-none">Подпишись на рассылку</h4>
                    <div class="newsLetter">
                        <input type="email"
                               name="email"
                               id="email"
                               placeholder="Email адрес" />
                        <button class="starta-button submit">
                            <span class="position-relative">Подписаться</span>
                            <span class="starta-button-hover"></span>
                        </button>
                    </div>
                </div> *@
            </div>
        </div>

        <!-- copyright -->
        <div class="copyright pt-5 pb-5">
            © Ecobay.by 2018-@thisYear. ООО "ЭКОТЕХБЕЛК" УНП 491508819 | Разработка и поддержка Artbavial Software
        </div>
    </footer>
</div>


@using System.ComponentModel.DataAnnotations

@code
{
    #region Параметры маршрута и данные страницы

    [Parameter] public string? slug { get; set; }

    private PageCity? pageCity;
    private City? currentCity;
    private bool isCityMode => pageCity != null;

    private List<City> allCities = new();

    private PromoMessage? promo;   // промо из БД
    private Goal? goal;            // цели по году

    #endregion

    #region Константы и текстовые данные

    private string? formErrorMessage;
    private List<PageCity> footerCities = new();
    string phone = "+375 (29) 991-06-66"; // дефолтный телефон
    string thisYear = DateTime.Now.Year.ToString();
    int ProgresPercent = 0;
    int year = DateTime.Now.Year;
    string Title = "Вывоз бытовой техники по всей Беларуси";

    #endregion

    #region Калькулятор выплаты

    private decimal price = 0.20m;   // цена за 1 кг (дефолт)
    private decimal weight = 500;    // начальный вес
    private decimal total;
    private string resultMessage = "";

    private void Calculate()
    {
        if (weight > 0)
        {
            total = weight * price;
            resultMessage =
                $"Вы получите <strong>~{total:F2} BYN</strong> за {weight} кг техники.*";
        }
        else
        {
            resultMessage = "Введите корректный вес.";
        }
    }

    #endregion

    #region Показатели/цели

    private int totalClientsDisplay;
    private int totalItemsDisplay;
    private int progressPercentDisplay;

    #endregion

    #region Жизненный цикл компонента

    protected override async Task OnParametersSetAsync()
    {
        await EnsureSeedDataAsync();

        footerCities = await Db.PageCities
            .Include(p => p.City)
            .OrderBy(p => p.City.Name)
            .ToListAsync();

        // 1. Город / список городов
        if (!string.IsNullOrWhiteSpace(slug))
        {
            // режим конкретного города
            pageCity = await Db.PageCities
                .Include(p => p.City)
                .FirstOrDefaultAsync(p => p.City.Slug == slug);

            currentCity = pageCity?.City;
        }
        else
        {
            // режим по умолчанию — вся Беларусь
            pageCity = null;
            currentCity = null;

            allCities = await Db.Cities
                .OrderBy(c => c.Name)
                .ToListAsync();
        }

        // 2. Настройка заголовков/цены/телефона
        if (pageCity != null && currentCity != null)
        {
            Title = pageCity.Title;
            phone = pageCity.PhoneCity ?? currentCity.DefaultPhone ?? phone;
            price = pageCity.Price ?? currentCity.DefaultPrice ?? price;
        }
        else
        {
            Title = "Вывоз бытовой техники по всей Беларуси";
            phone = "+375 (29) 991-06-66";
            price = 0.20m;
        }

        // 3. Промо-сообщение

        if (currentCity != null)
        {
            // 1) сначала пробуем промо для конкретного города
            promo = await Db.PromoMessages
                .Where(p => p.IsActive && p.CityId == currentCity.Id)
                .FirstOrDefaultAsync();

            // 2) если нет городского промо — берём общее
            if (promo == null)
            {
                promo = await Db.PromoMessages
                    .Where(p => p.IsActive && p.CityId == null)
                    .FirstOrDefaultAsync();
            }
        }
        else
        {
            // главная / вся Беларусь — только общее промо
            promo = await Db.PromoMessages
                .Where(p => p.IsActive && p.CityId == null)
                .FirstOrDefaultAsync();
        }

        isPromoVisible = promo != null;

        // 4. Цели и прогресс
        await LoadGoalsAsync();

        // 5. Калькулятор и видео
        Calculate();
    }

    private async Task LoadGoalsAsync()
    {
        var currentYear = DateTime.Now.Year;

        goal = await Db.Goals
            .Where(g => g.IsActive && g.Year == currentYear)
            .OrderByDescending(g => g.StartDate)
            .FirstOrDefaultAsync();

        if (goal == null)
        {
            goal = new Goal
            {
                Year = currentYear,
                TargetClients = 5000,
                TargetItems = 12000,
                ActualClients = 0,
                ActualItems = 0,
                InactiveRequests = 0,
                StartDate = new DateTime(currentYear, 1, 5),
                IsActive = true
            };
            Db.Goals.Add(goal);
            await Db.SaveChangesAsync();
        }

        // цели, которые показываем в блоке
        totalClientsDisplay = goal.TargetClients;
        totalItemsDisplay = goal.TargetItems;

        // прогресс по формуле (ActualClients + InactiveRequests) / TargetClients
        var clientsProgress = goal.ActualClients + goal.InactiveRequests;

        if (goal.TargetClients > 0)
            progressPercentDisplay = (int)Math.Round(100.0 * clientsProgress / goal.TargetClients);
        else
            progressPercentDisplay = 0;

        ProgresPercent = progressPercentDisplay;
    }

    private static int CalculateVirtualAdds(DateTime start, DateTime now)
    {
        if (now <= start)
            return 0;

        int total = 0;
        var day = start.Date;

        while (day <= now.Date)
        {
            for (int hour = 8; hour <= 21; hour++)
            {
                var point = day.AddHours(hour);
                if (point > now)
                    break;

                if (point >= start)
                    total++;
            }

            day = day.AddDays(1);
        }

        return total;
    }

    #endregion

    #region Инициализация JS (меню, анимации и др.)

    private bool _menuInitCalled;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_menuInitCalled)
        {
            _menuInitCalled = true;
            try
            {
                await JS.InvokeVoidAsync("mobileMenu.init");
                await JS.InvokeVoidAsync("initHoverButtons");
                await JS.InvokeVoidAsync("initVideoBlock");
                await JS.InvokeVoidAsync("initCircleText");
                await JS.InvokeVoidAsync("initGsapAnimations");
                await JS.InvokeVoidAsync("initSwiper");
                // await JS.InvokeVoidAsync("initMobileMenu");
            }
            catch (Exception ex)
            {
                Console.WriteLine("JS init error in Home: " + ex);
            }
        }
    }

    #endregion

    #region Отправка заявки (форма -> Client + Request)

    private RequestFormModel form = new();
    private bool isSending;
    private bool isSuccessMessageVisible;

    private async Task OnSubmitAsync()
    {
        if (isSending)
            return;

        isSending = true;
        isSuccessMessageVisible = false;
        formErrorMessage = null;

        try
        {
            // нормализуем телефон
            form.Phone = NormalizePhone(form.Phone ?? string.Empty);

            // достаём только цифры для проверки длины
            var digits = new string((form.Phone ?? string.Empty)
                .Where(char.IsDigit)
                .ToArray());

            if (string.IsNullOrWhiteSpace(form.Phone) || digits.Length == 0)
            {
                formErrorMessage = "Укажите телефон.";
                return;
            }

            if (digits.Length < 9 || digits.Length > 15)
            {
                formErrorMessage = "Телефон должен содержать от 9 до 15 цифр.";
                return;
            }

            var last9 = GetLast9Digits(form.Phone!);
            if (string.IsNullOrEmpty(last9))
            {
                formErrorMessage = "Не удалось распознать номер телефона.";
                return;
            }

            var client = await Db.Clients
                .FirstOrDefaultAsync(c => c.Phone.EndsWith(last9));

            if (client == null)
            {
                client = new Client
                {
                    Name = form.Name ?? string.Empty,
                    Phone = form.Phone,
                    Comment = form.Comment,
                    CityId = currentCity?.Id
                };

                Db.Clients.Add(client);
                await Db.SaveChangesAsync();
            }
            else
            {
                if (!string.IsNullOrWhiteSpace(form.Name))
                    client.Name = form.Name;
                if (!string.IsNullOrWhiteSpace(form.Comment))
                    client.Comment = form.Comment;

                await Db.SaveChangesAsync();
            }

            var request = new Request
            {
                ClientId = client.Id,
                PageCityId = pageCity?.Id,
                DateCreate = DateTime.Now,
                Message = form.Comment,
                Source = slug is null ? "/" : $"/city/{slug}"
            };

            Db.Requests.Add(request);

            if (goal != null)
            {
                goal.ActualClients += 1;
                goal.ActualItems += 1;
            }

            await Db.SaveChangesAsync();

            try
            {
                await EmailSender.SendRequestCreatedAsync(client, request, currentCity, pageCity);
            }
            catch (Exception ex)
            {
                Console.WriteLine("Email send error: " + ex);
            }

            form = new RequestFormModel();
            isSuccessMessageVisible = true;
        }
        finally
        {
            isSending = false;
        }
    }

    public class RequestFormModel
    {
        public string? Name { get; set; }
        public string? Phone { get; set; }
        public string? Comment { get; set; }
    }

    private static string NormalizePhone(string phone)
    {
        if (string.IsNullOrWhiteSpace(phone))
            return phone;

        var cleaned = new string(phone.Where(c => char.IsDigit(c) || c == '+').ToArray());

        if (cleaned.StartsWith("+375"))
            return cleaned;

        if (cleaned.StartsWith("375"))
            return "+" + cleaned;

        var digits = new string(cleaned.Where(char.IsDigit).ToArray());
        if (digits.Length == 9)
            return "+375" + digits;

        return cleaned;
    }

    private static string GetLast9Digits(string input)
    {
        var digits = new string(input.Where(char.IsDigit).ToArray());
        if (digits.Length <= 9)
            return digits;
        return digits[^9..];
    }

    #endregion

    #region Промо-окно

    private bool isPromoVisible;

    private string promoTitle => promo?.Title ?? "Внимание!";
    private string promoText => promo?.Text
        ?? "В ближайшие выходные мы не работаем. Заявки будут обработаны в понедельник.";

    private void ShowPromo()
    {
        if (promo != null)
            isPromoVisible = true;
    }

    private void ClosePromo()
    {
        isPromoVisible = false;
    }

    #endregion

    private void OnPhoneFocus()
    {
        if (string.IsNullOrWhiteSpace(form.Phone))
        {
            form.Phone = "+375";
        }
    }

    private async Task EnsureSeedDataAsync()
    {
        if (await Db.Cities.AnyAsync())
            return;

        const decimal basePrice = 0.20m;
        const string basePhone = "+375 (29) 991-06-66";

        var cities = new List<City>
        {
            new City
            {
                Name = "Гомель",
                NameIn = "Гомеле",
                Slug = "gomel",
                DefaultPhone = basePhone,
                DefaultPrice = basePrice
            },
            new City
            {
                Name = "Рогачёв",
                NameIn = "Рогачёве",
                Slug = "rogachev",
                DefaultPhone = basePhone,
                DefaultPrice = basePrice
            },
            new City
            {
                Name = "Бобруйск",
                NameIn = "Бобруйске",
                Slug = "bobruisk",
                DefaultPhone = basePhone,
                DefaultPrice = basePrice
            },
            new City
            {
                Name = "Жлобин",
                NameIn = "Жлобине",
                Slug = "zhlobin",
                DefaultPhone = basePhone,
                DefaultPrice = basePrice
            },
            new City
            {
                Name = "Светлогорск",
                NameIn = "Светлогорске",
                Slug = "svetlogorsk",
                DefaultPhone = basePhone,
                DefaultPrice = basePrice
            }
        };

        Db.Cities.AddRange(cities);
        await Db.SaveChangesAsync();

        var pages = cities.Select(c => new PageCity
        {
            CityId = c.Id,
            Title = $"Вывоз бытовой техники в {c.NameIn}",
            Description = $"Быстрый и выгодный вывоз бытовой техники в {c.NameIn}. Цена от {basePrice:0.00} BYN за кг.",
            KeyWords = $"вывоз техники {c.Name}, утилизация техники {c.Name}, приём техники {c.Name}",
            Price = basePrice,
            PhoneCity = basePhone,
            IsShowPromo = false
        }).ToList();

        Db.PageCities.AddRange(pages);
        await Db.SaveChangesAsync();
    }
}



